<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Smart Code Prompts - Studio</title>
	<!-- MODIFIED: Removed CDN links for Tailwind and DaisyUI. -->
	<!-- MODIFIED: Switched Font Awesome to a local version from node_modules. -->
	<link href="/node_modules/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
	<!-- MODIFIED: Point to the compiled CSS file generated by the build process. -->
	<link rel="stylesheet" href="/dist/output.css">
	<script type="module" src="js/main.js"></script>
</head>
<!-- MODIFIED: Body now uses flex to create the main layout structure -->
<body class="h-screen overflow-hidden">
<div class="flex h-full">
	<!-- Left Icon Sidebar -->
	<aside class="flex flex-col items-center gap-4 p-2 bg-base-200 border-r border-base-300">
		<a href="/" class="text-blue-500 text-2xl" title="Smart Code Prompts">
			<i class="fa-solid fa-brain"></i>
		</a>
		<div class="flex flex-col gap-5 text-xl text-base-content/60 items-center">
			<a href="/projects" title="Select Projects"><i class="fa-solid fa-database"></i></a>
			<a href="/setup" title="Configure"><i class="fa-solid fa-gears"></i></a>
		</div>
	</aside>
	
	<!-- Main Content Area -->
	<!-- MODIFIED: Removed main header, content now starts from the top -->
	<div class="flex flex-col flex-grow">
		<!-- File Tree and Workspace -->
		<!-- MODIFIED: Added id, changed grid-cols for resizer, and added overflow-hidden -->
		<div id="main-split-pane" class="grid grid-cols-[320px_auto_1fr] flex-grow overflow-hidden">
			<!-- MODIFIED: Wrapped file tree in a pane div for resizing -->
			<div id="file-tree-pane" class="flex flex-col h-full border-r border-base-300 overflow-hidden">
				<div class="p-2 border-b border-base-300 flex-shrink-0">
					<select id="projects-dropdown" class="select select-bordered select-sm w-full"></select>
				</div>
				<div id="file-tree" class="flex-grow p-2 overflow-auto font-mono text-sm"></div>
			</div>
			
			<!-- NEW: Vertical resizer element -->
			<div id="vertical-resizer"></div>
			
			<!-- MODIFIED: Wrapped workspace in a pane div for structure -->
			<div id="workspace-pane" class="flex flex-col h-full bg-base-200/30 overflow-hidden">
				<!-- MODIFIED: Added relative positioning to contain the copy button -->
				<div id="workspace" class="relative flex flex-col h-full">
					<!-- The main prompt building textarea -->
					<textarea id="selected-content"
					          class="textarea textarea-bordered w-full flex-grow font-mono text-xs rounded-none border-0 p-4"></textarea>
					
					<!-- MODIFIED: Moved button to the bottom-left corner -->
					<button id="copy-prompt-button" class="btn btn-sm btn-ghost absolute bottom-2 right-2 z-10" title="Copy to Clipboard">
						<i class="fa-solid fa-clipboard"></i> Copy
					</button>
					
					<!-- The new container for the analysis view, replacing the old modal -->
					<div id="analysis-view" class="hidden h-full overflow-y-auto">
						<!-- Analysis content will be injected here -->
					</div>
				</div>
			</div>
		</div>
		
		<!-- NEW: Horizontal resizer element -->
		<div id="horizontal-resizer"></div>
		
		<!-- NEW: Wrapper for the bottom panel, which is now a flex container -->
		<!-- MODIFIED: Removed fixed height to allow for auto-expansion -->
		<div id="bottom-panel" class="flex flex-col flex-shrink-0">
			
			<!-- Bottom Prompt Input -->
			<div class="p-3 border-t border-base-300 bg-base-100">
				<div class="flex items-start gap-2">
        <textarea id="prompt-input" placeholder="Start typing a prompt..."
                  class="textarea textarea-bordered w-full flex-grow" rows="1"></textarea>
					<div class="flex-shrink-0 flex flex-col items-center gap-2">
						<button id="bottom-run-button" class="btn btn-primary btn-sm">
							Run <i class="fa-solid fa-arrow-right"></i>
						</button>
						<button id="reanalyze-and-run-button" class="btn btn-secondary btn-sm" title="Re-analyze modified files, then run the prompt">
							<i class="fa-solid fa-arrows-rotate"></i>Run
						</button>
					</div>
				</div>
			</div>
			
			<!-- Status Bar -->
			<div id="status-bar-container" class="border-t border-base-300 bg-base-100 py-1 px-3 flex-shrink-0">
				<div class="flex justify-between items-center w-full">
					<div id="status-bar-progress-container" class="items-center gap-2" style="display: none; width: 50%;">
						<span id="status-bar-progress-text" class="text-sm"></span>
						<progress id="status-bar-progress-bar" class="progress progress-info w-full" value="0"
						          max="100"></progress>
					</div>
					<div id="status-bar-message" class="flex-grow text-center text-sm truncate" title=""></div>
					<!-- NEW: Loading indicator moved from header -->
					<button id="loading-indicator" class="btn btn-sm btn-ghost" style="display: none;">
						<span class="loading loading-spinner loading-xs"></span> Loading...
					</button>
					<div id="status-bar-tokens" class="flex items-center gap-4">
						<button id="log-modal-button" class="btn btn-sm btn-ghost" title="View LLM Call Log">
							<i class="fa-solid fa-list-ul"></i>
						</button>
						<div class="flex items-center gap-1 text-sm" title="Prompt Tokens this Session">
							<i class="fa-solid fa-circle-up text-success"></i>
							<span id="prompt-tokens">0</span>
						</div>
						<div class="flex items-center gap-1 text-sm" title="Completion Tokens this Session">
							<i class="fa-solid fa-circle-down text-info"></i>
							<span id="completion-tokens">0</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Right Settings Sidebar -->
	<aside class="w-80 p-4 border-l border-base-300 bg-base-200 overflow-y-auto">
		<div class="flex justify-between items-center mb-4">
			<h2 class="text-lg font-bold">Run settings</h2>
			<button id="toggle-mode" class="btn btn-sm btn-outline">
				<i class="fas fa-sun"></i>
			</button>
		</div>
		
		<div class="space-y-4">
			<div class="form-control">
				<label class="label"><span class="label-text">LLM Model</span></label>
				<div class="flex gap-2">
					<select id="llm-dropdown" class="select select-bordered select-sm w-full" title="Select LLM"></select>
					<button id="refresh-llms" class="btn btn-sm btn-square btn-outline" title="Refresh LLM List">
						<i class="fas fa-sync-alt"></i>
					</button>
				</div>
			</div>
			
			<div class="divider"></div>
			
			<h3 class="font-bold">Tools</h3>
			<!-- MODIFIED: Replaced the "Analysis Actions" modal button with direct action buttons. -->
			<div class="grid gap-2">
				<button class="btn btn-primary btn-sm" id="analyzeSelectedButton"
				        title="Performs a one-time analysis on the files currently checked in the file tree.">
					<i class="fa-solid fa-check-square me-2"></i>Analyze Selected
				</button>
				<button class="btn btn-info btn-sm" id="reanalyzeModifiedOnlyButton"
				        title="Scans for files changed since their last analysis and re-analyzes only those.">
					<i class="fa-solid fa-file-pen me-2"></i>Re-analyze Modified
				</button>
				<button class="btn btn-error btn-sm" id="reanalyzeForceAllButton"
				        title="Re-analyzes every file that has a previous analysis, regardless of changes.">
					<i class="fa-solid fa-arrows-rotate me-2"></i>Force Re-analyze All
				</button>
			</div>
			<!-- MODIFIED: Replaced multi-select listbox with a dropdown with checkboxes for better UX. -->
			<div class="form-control">
				<label class="label">
					<span class="label-text">Compress Extensions</span>
				</label>
				<!-- MODIFIED: Changed to dropdown-bottom and added an ID to manage state with JS. Removed tabindex attributes. -->
				<div id="compress-extensions-dropdown" class="dropdown dropdown-bottom w-full">
					<label id="compress-extensions-button" class="btn btn-sm w-full justify-start font-normal border-base-300 bg-base-100 hover:bg-base-200" title="Select extensions to compress">Select extensions...</label>
					<ul id="compress-extensions-dropdown-menu" class="dropdown-content z-[1] p-2 shadow bg-base-300 rounded-box w-full max-h-60 overflow-y-auto flex flex-col">
					<!-- Checkboxes will be populated by JS -->
						<li><a>Loading...</a></li>
					</ul>
				</div>
			</div>
			<div class="form-control">
				<label class="label cursor-pointer">
					<span class="label-text">Unselect All Files</span>
					<button id="unselect-all" class="btn btn-xs btn-outline" title="Unselect All Files"><i
						class="fa-solid fa-rotate-right"></i> Clear
					</button>
				</label>
			</div>
			
			<div class="divider"></div>
			
			<!-- Placeholder settings to match screenshot -->
			<div class="form-control">
				<label class="label"><span class="label-text">Temperature</span></label>
				<input id="temperature-slider" type="range" min="0" max="1" value="0.25" step="0.01"
				       class="range range-sm"/>
			</div>
		</div>
	</aside>
</div>

<!-- Modals (kept for search, etc.) -->
<dialog id="searchModal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg" id="searchModalLabel">Search in Folder</h3>
		<p class="py-4">Searching within: <strong id="searchModalFolderPath"></strong></p>
		<div class="form-control">
			<label class="label" for="searchTermInput">
				<span class="label-text">Search Term (case-insensitive):</span>
			</label>
			<input type="text" class="input input-bordered" id="searchTermInput"
			       placeholder="Enter text to search for...">
		</div>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
			<button class="btn btn-primary" id="performSearchButton">Search Files</button>
		</div>
	</div>
</dialog>

<dialog id="logModal" class="modal">
	<div class="modal-box w-11/12 max-w-7xl">
		<h3 class="font-bold text-lg" id="logModalLabel">LLM Call Log (This Session)</h3>
		<div class="py-4" id="logModalBody">
			<p class="text-base-content/70">No LLM calls have been made in this session yet.</p>
		</div>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
		</div>
	</div>
</dialog>

</body>
</html>
