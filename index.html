<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Smart Code Prompts - Studio</title>
	<!-- MODIFIED: Swapped Font Awesome for Bootstrap Icons -->
	<link href="/node_modules/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
	<link rel="stylesheet" href="/dist/output.css">
	<script type="module" src="js/main.js"></script>
</head>
<body class="h-screen overflow-hidden">
<div class="flex h-full" id="app-container"> <!-- MODIFIED: Added ID for sidebar control -->
	<!-- Left Icon Sidebar -->
	<aside class="flex flex-col items-center gap-4 p-2 bg-base-200 border-r border-base-300">
		<a href="/" class="text-blue-500 text-2xl" title="Smart Code Prompts">
			<i class="bi bi-award"></i>
		</a>
		<div class="flex flex-col gap-5 text-xl text-base-content/60 items-center">
			<div id="toggle-mode" class="cursor-pointer" title="Toggle Light/Dark Mode">
				<i class="bi bi-sun"></i>
			</div>
			<a href="/projects" title="Select Projects"><i class="bi bi-database"></i></a>
			<a href="#" id="qa-modal-button" title="Ask a Question"><i class="bi bi-question-circle"></i></a>
			<a href="/setup" title="Configure"><i class="bi bi-gear-fill"></i></a>
			<div id="unselect-all" class="cursor-pointer" title="Unselect All Files">
				<i class="bi bi-eraser"></i>
			</div>
			<!-- NEW: Right sidebar toggle button -->
			<div id="toggle-right-sidebar" class="cursor-pointer" title="Toggle Settings Panel">
				<i class="bi bi-layout-sidebar-reverse"></i>
			</div>
		</div>
	</aside>
	
	<!-- Main Content Area -->
	<div class="flex flex-col flex-grow">
		<!-- File Tree and Workspace -->
		<div id="main-split-pane" class="grid grid-cols-[320px_auto_1fr] flex-grow overflow-hidden">
			<div id="file-tree-pane" class="flex flex-col h-full border-r border-base-300 overflow-hidden">
				<div class="p-2 border-b border-base-300 flex-shrink-0">
					<select id="projects-dropdown" class="select select-bordered select-sm w-full"></select>
				</div>
				<div id="file-tree" class="flex-grow p-2 overflow-auto font-mono text-sm"></div>
			</div>
			
			<div id="vertical-resizer"></div>
			
			<div id="workspace-pane" class="flex flex-col h-full bg-base-200/30 overflow-hidden">
				<div id="workspace" class="relative flex flex-col h-full">
					<!-- The main prompt building textarea -->
					<textarea id="selected-content"
					          class="textarea textarea-bordered w-full flex-grow font-mono text-xs rounded-none border-0 p-4"></textarea>
					
					<button id="copy-prompt-button" class="btn btn-sm btn-ghost absolute bottom-2 right-2 z-10"
					        title="Copy to Clipboard">
						<!-- MODIFIED: Icon changed -->
						<i class="bi bi-clipboard"></i> Copy
					</button>
					
					<!-- The new container for the analysis view, replacing the old modal -->
					<div id="analysis-view" class="hidden h-full overflow-y-auto">
						<!-- Analysis content will be injected here -->
					</div>
				</div>
			</div>
		</div>
		
		<div id="horizontal-resizer"></div>
		
		<div id="bottom-panel" class="flex flex-col flex-shrink-0">
			
			<!-- Bottom Prompt Input -->
			<div class="p-3 border-t border-base-300 bg-base-100">
				<div class="flex items-start gap-2">
        <textarea id="prompt-input" placeholder="Start typing a prompt..."
                  class="textarea textarea-bordered w-full flex-grow" rows="1"></textarea>
					<div class="flex-shrink-0 flex flex-col items-center gap-2">
						<button id="smart-prompt-run-button" class="btn btn-primary btn-sm" title="Run prompt (Ctrl+Enter)">
							Run <kbd class="kbd kbd-xs">ctrl + <i class="bi bi-arrow-return-left"></i></kbd>
						
						</button>
					</div>
				</div>
			</div>
			
			<!-- Status Bar -->
			<div id="status-bar-container" class="border-t border-base-300 bg-base-100 py-1 px-3 flex-shrink-0">
				<div class="flex justify-between items-center w-full">
					<div id="status-bar-progress-container" class="items-center gap-2" style="display: none; width: 50%;">
						<span id="status-bar-progress-text" class="text-sm"></span>
						<progress id="status-bar-progress-bar" class="progress progress-info w-full" value="0"
						          max="100"></progress>
					</div>
					<div id="status-bar-message" class="flex-grow text-center text-sm truncate" title=""></div>
					<button id="loading-indicator" class="btn btn-sm btn-ghost" style="display: none;">
						<span class="loading loading-spinner loading-xs"></span> Loading...
					</button>
					<div id="status-bar-tokens" class="flex items-center gap-4">
						<button id="log-modal-button" class="btn btn-sm btn-ghost" title="View LLM Call Log">
							<i class="bi bi-card-list"></i>
						</button>
						<div class="flex items-center gap-1 text-sm" title="Prompt Tokens this Session">
							<i class="bi bi-arrow-up-circle text-success"></i>
							<span id="prompt-tokens">0</span>
						</div>
						<div class="flex items-center gap-1 text-sm" title="Completion Tokens this Session">
							<i class="bi bi-arrow-down-circle text-info"></i>
							<span id="completion-tokens">0</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Right Settings Sidebar -->
	<aside class="w-80 p-4 border-l border-base-300 bg-base-200 overflow-y-auto" id="right-sidebar"> <!-- MODIFIED: Added ID for sidebar control -->
		<div class="space-y-4">
			<div class="form-control">
				<label class="label"><span class="label-text">LLM Model</span></label>
				<div class="flex gap-2">
					<select id="llm-dropdown" class="select select-bordered select-sm w-full" title="Select LLM"></select>
					<button id="refresh-llms" class="btn btn-sm btn-square btn-outline" title="Refresh LLM List">
						<i class="bi bi-arrow-clockwise"></i>
					</button>
				</div>
			</div>
			
			<div class="divider"></div>
			
			<h3 class="font-bold">Tools</h3>
			<div class="grid gap-2">
				<button class="btn btn-primary btn-sm" id="analyzeSelectedButton"
				        title="Performs a one-time analysis on the files currently checked in the file tree.">
					<!-- MODIFIED: Icon changed -->
					<i class="bi bi-check-square me-2"></i>Analyze Selected
				</button>
				<button class="btn btn-info btn-sm" id="reanalyzeModifiedOnlyButton"
				        title="Scans for files changed since their last analysis and re-analyzes only those.">
					<!-- MODIFIED: Icon changed -->
					<i class="bi bi-file-earmark-diff me-2"></i>Re-analyze Modified
				</button>
				<button class="btn btn-error btn-sm" id="reanalyzeForceAllButton"
				        title="Re-analyzes every file that has a previous analysis, regardless of changes.">
					<!-- MODIFIED: Icon changed -->
					<i class="bi bi-arrow-repeat me-2"></i>Force Re-analyze All
				</button>
			</div>
			<div class="form-control">
				<label class="label">
					<span class="label-text">Compress Extensions</span>
				</label>
				<div id="compress-extensions-dropdown" class="dropdown dropdown-bottom w-full">
					<label id="compress-extensions-button"
					       class="btn btn-sm w-full justify-start font-normal border-base-300 bg-base-100 hover:bg-base-200"
					       title="Select extensions to compress">Select extensions...</label>
					<ul id="compress-extensions-dropdown-menu"
					    class="dropdown-content z-[1] p-2 shadow bg-base-300 rounded-box w-full max-h-60 overflow-y-auto flex flex-col">
						<!-- Checkboxes will be populated by JS -->
						<li><a>Loading...</a></li>
					</ul>
				</div>
			</div>
			
			<div class="divider"></div>
			
			<div class="form-control">
				<label class="label">
					<span class="label-text">Temperature</span>
					<span class="label-text-alt" id="temperature-value">0.25</span>
				</label>
				<input id="temperature-slider" type="range" min="0" max="1" value="0.25" step="0.01"
				       class="range range-sm"/>
			</div>
		</div>
	</aside>
</div>

<!-- Modals -->
<dialog id="searchModal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg" id="searchModalLabel">Search in Folder</h3>
		<p class="py-4">Searching within: <strong id="searchModalFolderPath"></strong></p>
		<div class="form-control">
			<label class="label" for="searchTermInput">
				<span class="label-text">Search Term (case-insensitive):</span>
			</label>
			<input type="text" class="input input-bordered" id="searchTermInput"
			       placeholder="Enter text to search for...">
		</div>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
			<button class="btn btn-primary" id="performSearchButton">Search Files</button>
		</div>
	</div>
</dialog>

<dialog id="logModal" class="modal">
	<!-- MODIFIED: Added flex classes for fixed footer -->
	<div class="modal-box w-11/12 max-w-7xl h-5/6 flex flex-col">
		<h3 class="font-bold text-lg flex-shrink-0" id="logModalLabel">LLM Call Log (Persistent)</h3>
		<!-- MODIFIED: Added flex-grow and overflow for scrolling content -->
		<div class="py-4 flex-grow overflow-y-auto" id="logModalBody">
			<p class="text-base-content/70">No LLM calls have been made yet.</p>
		</div>
		<!-- MODIFIED: This is now the fixed footer -->
		<div class="modal-action flex-shrink-0 border-t border-base-300 pt-4">
			<!-- NEW: Button to reset the log and token counts -->
			<button class="btn btn-error" id="reset-log-button">Reset Log & Tokens</button>
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
		</div>
	</div>
</dialog>

<dialog id="reanalysisPromptModal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg">Re-analysis Recommended</h3>
		<p class="py-4">For the best results, it's recommended to re-analyze modified files before running the prompt.</p>
		<p id="reanalysis-file-count" class="font-bold mb-4"></p>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn">Cancel</button>
			</form>
			<button class="btn" id="run-without-reanalysis-button">Run Anyway</button>
			<button class="btn btn-primary" id="run-with-reanalysis-button">Re-analyze and Run</button>
		</div>
	</div>
</dialog>

<!-- NEW: QA Modal -->
<dialog id="qaModal" class="modal">
	<div class="modal-box w-11/12 max-w-4xl h-5/6 flex flex-col">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg" id="qa-modal-title">Ask a Question</h3>
		<div id="qa-chat-window" class="flex-grow overflow-y-auto my-4 p-2 bg-base-200 rounded-lg">
			<!-- Chat messages will be appended here -->
		</div>
		<div class="flex gap-2">
			<textarea id="qa-input" class="textarea textarea-bordered flex-grow" placeholder="Ask anything about your code..."
			          rows="1"></textarea>
			<button id="qa-send-button" class="btn btn-primary">Send</button>
		</div>
	</div>
</dialog>


</body>
</html>
