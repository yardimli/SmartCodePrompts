<!-- SmartCodePrompts/modals.html -->
<!-- DELETED: The Project Browser Modal is no longer needed. -->

<!-- Search Modal -->
<dialog id="search_modal" class="modal">
	<div class="modal-box w-11/12 max-w-5xl h-5/6 flex flex-col">
		<h3 class="font-bold text-lg flex-shrink-0" id="search_modal_label">Search Project Files</h3>
		<p class="py-2 text-sm text-base-content/70 flex-shrink-0">Search for text within all files in the current project.</p>
		<div class="form-control flex-shrink-0">
			<div class="join w-full">
				<input type="text" class="input input-bordered join-item w-full" id="search_term_input"
				       placeholder="Enter text to search for...">
				<button class="btn btn-primary join-item" id="perform_search_button">Find</button>
			</div>
		</div>
		
		<!-- NEW: Two-pane layout for results and preview -->
		<div class="flex-grow flex mt-4 gap-4 overflow-hidden">
			<!-- Left Pane: Search Results List -->
			<div id="search-results-list-container" class="w-1/3 flex flex-col">
				<h4 class="font-bold text-sm flex-shrink-0 mb-2">Matching Files</h4>
				<div id="search-results-list" class="flex-grow p-2 bg-base-200 rounded-md overflow-y-auto font-mono text-xs">
					<p class="text-base-content/60 text-center font-sans text-sm">Enter a search term and click "Find".</p>
				</div>
			</div>
			
			<!-- Right Pane: File Content Preview -->
			<div id="search-preview-container" class="w-2/3 flex flex-col">
				<div class="flex-shrink-0 flex justify-between items-center mb-2">
					<h4 id="search-preview-title" class="font-bold text-sm truncate">Select a file to preview</h4>
					<!-- NEW: Navigation for matches -->
					<div id="search-preview-nav" class="hidden">
						<span id="search-preview-matches" class="text-sm mr-2"></span>
						<div class="join">
							<button id="search-prev-match-btn" class="btn btn-xs join-item">Prev</button>
							<button id="search-next-match-btn" class="btn btn-xs join-item">Next</button>
						</div>
					</div>
				</div>
				<textarea id="search-preview-content" class="textarea textarea-bordered w-full flex-grow bg-base-200 font-mono text-xs" readonly></textarea>
			</div>
		</div>
		
		<div class="modal-action flex-shrink-0 border-t border-base-300 pt-4">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
			<button class="btn btn-success" id="check_matching_files_button" disabled>Check Matching Files</button>
		</div>
	</div>
</dialog>

<!-- Log Modal -->
<dialog id="log_modal" class="modal">
	<div class="modal-box w-11/12 max-w-7xl h-5/6 flex flex-col">
		<h3 class="font-bold text-lg flex-shrink-0" id="log_modal_label">LLM Call Log (Persistent)</h3>
		<div class="py-4 flex-grow overflow-y-auto" id="log_modal_body">
			<p class="text-base-content/70">No LLM calls have been made yet.</p>
		</div>
		<div class="modal-action flex-shrink-0 border-t border-base-300 pt-4">
			<button class="btn btn-error" id="reset-log-button">Reset Log & Tokens</button>
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
		</div>
	</div>
</dialog>

<!-- Reanalysis Prompt Modal -->
<dialog id="reanalysis_prompt_modal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg">Re-analysis Recommended</h3>
		<p class="py-4">For the best results, it's recommended to re-analyze modified files before running the prompt.</p>
		<p id="reanalysis-file-count" class="font-bold mb-4"></p>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn">Cancel</button>
			</form>
			<button class="btn" id="run-without-reanalysis-button">Run Anyway</button>
			<button class="btn btn-primary" id="run-with-reanalysis-button">Re-analyze and Run</button>
		</div>
	</div>
</dialog>

<!-- QA Modal -->
<dialog id="qa_modal" class="modal">
	<div class="modal-box w-11/12 max-w-4xl h-5/6 flex flex-col">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg" id="qa-modal-title">Ask a Question</h3>
		<div id="qa-chat-window" class="flex-grow overflow-y-auto my-2 p-2 bg-base-200 rounded-lg">
			<!-- Chat messages will be appended here -->
		</div>
		<div class="flex gap-2">
			<textarea id="qa-input" class="textarea textarea-bordered flex-grow" placeholder="Ask anything about your code..."
			          rows="1"></textarea>
			<button id="qa-send-button" class="btn btn-primary">Send</button>
		</div>
	</div>
</dialog>

<!-- Direct Prompt Modal -->
<dialog id="direct_prompt_modal" class="modal">
	<div class="modal-box w-11/12 max-w-4xl h-5/6 flex flex-col">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg">LLM Response</h3>
		<div id="direct-prompt-response" class="flex-grow overflow-y-auto mt-1 mb-1 p-2 bg-base-200 rounded-lg">
			<!-- LLM response will be appended here -->
		</div>
		<div class="modal-action border-t border-base-300 pt-1">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
		</div>
	</div>
</dialog>

<!-- NEW: Analysis Modal -->
<dialog id="analysis_modal" class="modal">
	<div class="modal-box w-11/12 max-w-4xl h-5/6 flex flex-col">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg" id="analysis-modal-title">File Analysis</h3>
		<div class="flex-grow my-1 rounded-lg">
			<textarea id="analysis-modal-content" class="textarea textarea-bordered w-full h-full font-mono text-xs" readonly></textarea>
		</div>
		<div class="modal-action border-t border-base-300 pt-1">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
		</div>
	</div>
</dialog>

<!-- NEW: File View Modal -->
<dialog id="file_view_modal" class="modal">
	<div class="modal-box w-11/12 max-w-5xl h-5/6 flex flex-col">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg" id="file-view-modal-title">File Content</h3>
		<div class="flex-grow my-1 rounded-lg">
			<textarea id="file-view-modal-content" class="textarea textarea-bordered w-full h-full font-mono text-xs" readonly></textarea>
		</div>
		<div class="modal-action border-t border-base-300 pt-1">
			<form method="dialog">
				<button class="btn">Close</button>
			</form>
		</div>
	</div>
</dialog>

<!-- Setup Modal -->
<dialog id="setup_modal" class="modal">
	<div class="modal-box w-11/12 max-w-4xl h-5/6 flex flex-col">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg flex-shrink-0">Application Setup</h3>
		<div class="flex-grow overflow-y-auto py-4">
			<div id="setup-loading-indicator" class="text-center p-5">
				<span class="loading loading-spinner loading-lg"></span>
			</div>
			
			<form id="setup-form" style="display: none;" class="space-y-6">
				<!-- DELETED: The server port alert is removed. -->
				
				<div class="form-control">
					<label class="label" for="allowed-extensions-input"><span
						class="label-text">Allowed File Extensions</span></label>
					<textarea class="textarea textarea-bordered font-mono" id="allowed-extensions-input" rows="4"
					          placeholder="Enter extensions separated by commas. e.g., js, php, py, html"></textarea>
					<label class="label"><span class="label-text-alt">Only files with these extensions will be shown.</span></label>
				</div>
				
				<div class="form-control">
					<label class="label" for="excluded-folders-input"><span class="label-text">Excluded Folders</span></label>
					<textarea class="textarea textarea-bordered font-mono" id="excluded-folders-input" rows="3"
					          placeholder="Enter folder names separated by commas. e.g., .git, node_modules, vendor"></textarea>
					<label class="label"><span class="label-text-alt">These folders will be ignored entirely.</span></label>
				</div>
				
				<!-- DELETED: The Server Port input control is removed. -->
				
				<div class="form-control">
					<label class="label" for="openrouter-api-key-input"><span class="label-text">OpenRouter API Key</span></label>
					<input type="password" class="input input-bordered font-mono" id="openrouter-api-key-input"
					       placeholder="sk-or-...">
					<label class="label"><span
						class="label-text-alt">Your API key for making requests to OpenRouter.ai for analysis.</span></label>
				</div>
				
				<div class="divider"></div>
				<h4 class="text-xl font-bold">LLM Prompts</h4>
				<div role="alert" class="alert">
					<span>Use <code>${file_path}</code> and <code>${file_content}</code> as placeholders in analysis prompts.</span>
				</div>
				
				<div class="form-control">
					<label class="label" for="prompt-file-overview-input"><span
						class="label-text">File Overview Prompt</span></label>
					<textarea class="textarea textarea-bordered font-mono h-32" id="prompt-file-overview-input"></textarea>
				</div>
				
				<div class="form-control">
					<label class="label" for="prompt-functions-logic-input"><span
						class="label-text">Functions & Logic Prompt</span></label>
					<textarea class="textarea textarea-bordered font-mono h-32" id="prompt-functions-logic-input"></textarea>
				</div>
				
				<div class="form-control">
					<label class="label" for="prompt-content-footer-input"><span
						class="label-text">Content Footer Prompt</span></label>
					<textarea class="textarea textarea-bordered font-mono h-32" id="prompt-content-footer-input"></textarea>
					<label class="label"><span class="label-text-alt">This text is appended to the main prompt when you combine multiple files.</span></label>
				</div>
				
				<div class="form-control">
					<label class="label" for="prompt-smart-prompt-input"><span
						class="label-text">Smart Prompt Builder Prompt</span></label>
					<textarea class="textarea textarea-bordered font-mono h-32" id="prompt-smart-prompt-input"></textarea>
					<label class="label"><span
						class="label-text-alt">Use <code>${user_prompt}</code> and <code>${analysis_data_string}</code> as placeholders.</span></label>
				</div>
			</form>
		</div>
		<div class="modal-action flex-shrink-0 border-t border-base-300 pt-4">
			<button type="button" id="reset-prompts-btn" class="btn btn-warning">Reset Prompts</button>
			<form method="dialog" class="ml-auto">
				<button class="btn">Close</button>
			</form>
			<button type="button" id="save-setup-button" class="btn btn-success">Save Configuration</button>
		</div>
	</div>
</dialog>

<!-- NEW: About Modal -->
<dialog id="about_modal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg">Welcome to Smart Code Prompts!</h3>
		<p class="py-4">
			This tool helps you build context-rich prompts for Large Language Models by analyzing your codebase.
		</p>
		<p>
			<strong>To get started:</strong>
		<ol class="list-decimal list-inside pl-4 space-y-1 mt-2">
			<li>Add a project folder using the <i class="bi bi-database-add"></i> icon or the dropdown.</li>
			<li>Select files in the file tree and click "Analyze Selected".</li>
			<li>Use the "Smart Prompt" bar to ask the LLM to select relevant files for your task.</li>
			<li>Copy the generated prompt and use it with your favorite LLM.</li>
		</ol>
		</p>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn btn-primary">Get Started</button>
			</form>
		</div>
	</div>
</dialog>
